provider "selectel" {
  # параметры аутентификации берутся из переменных окружения
}

# Заказ выделенного сервера AR21-SSD на суточный тарифный план
resource "selectel_dedicated_server" "test_server" {
  name             = "test-server-cl23"
  configuration_id = "8b64887c-d034-4ce1-a8c0-58287090e9b6"  # CL23-SSD
  location_id      = "MSK-2"
  billing_cycle    = "day"  # Суточный тарифный план
  os_id            = 1      # Ubuntu 22.04 LTS
  ssh_keys         = []     # Пустой список SSH ключей для простоты теста
}

# Data sources для получения доступной информации
data "selectel_dedicated_server_locations_v1" "all" {}
data "selectel_dedicated_server_configurations_v1" "all" {}
data "selectel_dedicated_server_os_v1" "all" {}

# Выводы для проверки
output "server_id" {
  value = selectel_dedicated_server_v1.test_server.id
}

output "server_name" {
  value = selectel_dedicated_server_v1.test_server.name
}

output "server_status" {
  value = selectel_dedicated_server_v1.test_server.status
}

output "available_locations" {
  value = [for loc in data.selectel_dedicated_server_locations_v1.all.locations : {
    id   = loc.id
    name = loc.name
    uuid = loc.uuid
  }]
}

output "available_configurations" {
  value = [for config in data.selectel_dedicated_server_configurations_v1.all.configurations : {
    id   = config.id
    name = config.name
  }]
}

# Переменные для аутентификации
variable "selectel_account_id" {
  description = "Selectel account ID (domain name)"
  type        = string
}

variable "selectel_username" {
  description = "Selectel service user username"
  type        = string
}

variable "selectel_password" {
  description = "Selectel service user password"
  type        = string
  sensitive   = true
} 